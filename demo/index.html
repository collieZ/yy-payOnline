<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>云药线上选药</title>
  <link rel="stylesheet" href="index.css">
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script> -->
  <script src="jquery.min.js"></script>
  <script src="jquery.cookie.min.js"></script>
  <script src="./src/gizwits_ws_0.3.0.min.js"></script>
  <script type="text/javascript">
    var gizwitsws;
    var devicesDid;

    var apiHost = "api.gizwits.com";
    var commType = "attrs_v4";
    var wechatOpenId = "1234567";
    var gizwitsAppId = "2b56234daf384c91a4c4b6e2a7c988f2";

    var sendArry = new Array(20); // 控制发送数组初始化
    sendArry.fill(0);

    var reciveBuffer = new Array(20); // 接收缓冲数组
    var historyBuffer = new Array(); // 历史存储数组

    $(document).ready(newObj || setDefault);

    function setDefault() {
      $('#apiHost').val($.cookie('apiHost'));
      $('#commType').val($.cookie('commType'));
      $('#wechatOpenId').val($.cookie('wechatOpenId'));
      $('#gizwitsAppId').val($.cookie('gizwitsAppId'));
    }

    function newObj() {
      gizwitsws = new GizwitsWS(apiHost, wechatOpenId, gizwitsAppId, commType);

      gizwitsws.onInit = onInit;
      gizwitsws.onConnected = onConnected;
      gizwitsws.onOnlineStatusChanged = onOnlineStatusChanged;
      gizwitsws.onReceivedRaw = onReceivedRaw;
      gizwitsws.onReceivedAttrs = onReceivedAttrs;
      gizwitsws.onError = onError;

      $.cookie('apiHost', apiHost);
      $.cookie('commType', commType);
      $.cookie('wechatOpenId', wechatOpenId);
      $.cookie('gizwitsAppId', gizwitsAppId);
      showScreen("初始化对象成功!");

      init();  // 初始化列表
    }

    function init() {   // 获取设备列表函数
      gizwitsws.init();
      conndids = [];
      showScreen("已发送init指令……");
    }

    function connect() {    // 建立websocket函数
      // var did = $('#did').val();
      var did = devicesDid;   // 获取设备did
      gizwitsws.connect(did);
      showScreen("已发送connect指令……");
    }

    function read() {   // 读取下位机设备信息函数
      var did = devicesDid;
      var names = '';
      if (names == "") {
        gizwitsws.read(did, null);
      } else {
        gizwitsws.read(did, JSON.parse(names));
      };
      showScreen("已发送read指令……");
    }

    function writeCommand() {     // 控制下位机设备函数
      var did = devicesDid;
      if (commType == "attrs_v4") {
        // var attrs = {"valuedata": [1,2,3,4]};     // 控制指令有点问题
        // var attrs = $('#command').val();
        var attrs = {"sellValueData": sendFontBuffer};    // 发送数组
        let toswjvalueData = JSON.stringify(attrs);
        console.log("发送到下位机的信息为："  + toswjvalueData);
        try {
          gizwitsws.write(did, JSON.parse(toswjvalueData));
          showScreen("已对设备" + did + "发送write指令: " + toswjvalueData);
        } catch (e) {
          showError("数据格式错误：" + e);
        }
      } else {
        var raw = $('#command').val();
        try {
          gizwitsws.send(did, JSON.parse(raw));
          showScreen("已对设备" + did + "发送raw指令: " + raw);
        } catch (e) {
          showError("数据格式错误：" + e);
        }

      }
    }

    function clearLog() {
      $('#log').html("");
    }

    //=========================================================
    // callback functions
    //=========================================================
    function onInit(devices) {    // 获取绑定设备列表
      if (devices.length == 0) {
        showScreen("没有绑定的设备");
      } else {
        for (var i = 0; i < devices.length; i++) {
          showScreen("==================================================");
          showScreen("已绑定设备，did=" + devices[i].did);
          showScreen("已绑定设备，mac=" + devices[i].mac);
          showScreen("已绑定设备，product_key=" + devices[i].product_key);
          showScreen("已绑定设备，is_online=" + devices[i].is_online);
          showScreen("已绑定设备, dev_alias=" + devices[i].dev_alias);
          showScreen("已绑定设备，remark=" + devices[i].remark);

          addSelectOption('#did', devices[i].did, devices[i].did);    // 添加设备did
          devicesDid = devices[i].did;
        }
        connect();  // 建立websocket连接
      }
    }

    function onConnected(did) {       // 连接成功回调函数
      // addSelectOption('#readDid', did, did);
      // addSelectOption('#writeDid', did, did);
      showScreen("与设备:" + did + "连接成功!");
      read();   // 连接成功后获取设备信息
    }

    function onOnlineStatusChanged(value) {   // 设备上下线状态变更提醒
      showScreen("设备上下线通知，did=" + value.did);
      showScreen("设备上下线通知，is_online=" + value.is_online);
    }

    function onReceivedRaw(value) {
      var str = "收到设备" + value.did + "的Raw: [";
      for (var i = 0; i < value.raw.length; i++) {
        str = str + value.raw[i] + ",";
      }
      str = str.substr(0, str.length - 1) + "]";
      showScreen(str);
    }

    function onReceivedAttrs(value) {     // 获取下位机数据  数据更新自动推送
      var str = "收到设备" + value.did + "的Attrs: ";
    //   for (var key in value.attrs) {
    //     str = str + key + ":" + value.attrs[key] + "; ";
    //   }
    //     MyTemperAndHumtyChart.data.labels.push('');
    //     getMcuValueDate(value.attrs["valuedata"]);  //  将接收到的arr数据复制到接收缓冲区中
    //     getMcuTemperture(value.attrs["Temperature"]);
    //     getMcuHumty(value.attrs["Humidity"]);
    //     // removeMcuData();
    //     showScreen(str);
    }

    function onError(value) {
      showError(value.toString());
    }

    function getMcuValueDate(value) {   // 更新药品库存信息
        
        let tempArry = new Array(8);
        reciveBuffer = [].concat(value);
        if (reciveBuffer[0] == 7 && reciveBuffer[9] == 7) {

            for (let i = 1; i <= 8; i++) {

                tempArry[i-1] = reciveBuffer[i] - 1;
            }
            if (historyBuffer.length >= 500) {
                /* 清空数组前一半数据 */
                historyBuffer.splice(0,250);
            }
            historyBuffer.push(tempArry);
            for (let i = 0; i < 8; i++) {

                MyStockChart.data.datasets[0].data[i] = tempArry[i];
            }
            MyStockChart.update();
        }
    }

    // function getMcuTemperture(value) {

    //     addData(MyTemperAndHumtyChart, '', 0, value);
    //     if (value >= 40) {

    //         $('#display-tem').css('color', 'red');  // 温度警报颜色
    //     }
    //     else $('#display-tem').css('color', '#66ccff');  // 温度显示
    //     $('#display-tem').text(value);
    // }

    // function getMcuHumty(value) {

    //     addData(MyTemperAndHumtyChart, '', 1, value);
    //     if (value >= 80) {

    //         $('#display-hum').css('color', 'blue');  // 警报颜色改变
    //     }
    //     else $('#display-hum').css('color', '#66ccff');  // 湿度显示
    //     $('#display-hum').text(value);
    // }

    // function removeMcuData() {
    //     if (MyTemperAndHumtyChart.data.datasets[0].data.length > 10) {   // 温度和湿度数据总数超过20个之后，前面的数据被清除

    //         removeData(MyTemperAndHumtyChart);  // 清空第一个数据
    //     }
    // }

    // setInterval(removeMcuData, 200);  // 定时清除数据点

    //=========================================================
    // inner functions
    //=========================================================
    function showScreen(txt) {
      $('#log').prepend('<p style="color: blue">' + txt + '</p>');
    }

    function showError(txt) {
      $('#log').prepend('<p style="color: red">' + txt + '</p>');
    }

    function addSelectOption(selectId, value, text) {     // 添加下拉框函数
      if ($(selectId + ' option[value =' + value + ']').length == 0) {
        $(selectId).append("<option value=" + value + ">" + text + "</option>");
      }
    }

  </script>
</head>
<body>
        <!--<p>（初始化对象的过程中，已经自动完成了callback函数的创建。）</p>-->
        <!--&lt;!&ndash; <h4>2. 然后，使用GizwitsWS.init()获取绑定列表</h4>-->
        <!--<button id="init" onclick="init()">Do it!</button> &ndash;&gt;-->
        <!--<br/>-->
        <!-- <p>（绑定列表会在onInit这个callback函数返回。）</p> -->
        <!-- <h4>3. 接着，选择一个设备，创建websocket连接</h4> -->
        <!--<label style="display:inline-block;width: 90px">did:</label><select id="did" about="" style="width: 300px;"></select>-->
        <!--<button id="connect" onclick="connect()">Do it!</button>-->
        <!--<br/>-->
        <!--<p>（websocket创建成功，会回调函数onConnected。）</p>-->
        <!--<h4>4. 选择已连接设备，读取状态</h4>-->
        <!--<label style="display:inline-block;width: 90px">did:</label><select id="readDid" about="" style="width: 300px;"></select>-->
        <!--<label>names:</label><br/>-->
        <!--<textarea rows="1" cols="1" id="names"></textarea>    // 读数据-->

        <!--<br/>-->
        <!--<p>（发送指令成功后，稍后会收到设备状态信息。）</p>-->
        <!--<h4>5. 选择已连接设备，控制一下</h4>-->
        <!--<label style="display:inline-block;width: 90px">did:</label><select id="writeDid" about="" style="width: 300px;"></select>-->
        <!--<br/>-->
        <!--<label>command:</label><br/>-->



        <!-- <div class="pageWrapper">
              <div class="head-nav">
                  <div class="head-inner">
                      <div class="head-unit header-logo">
                          <div class="nav-logo">
                              <a href="http://www.baidu.com" class="nav-logo-inner"></a>
                          </div>
                      </div>

                  </div>

              </div>

              <div class="container animate" style="left: 0px;">
                  <div class="aside" id="aside-menus">
                      <div class="side-area-main">
                          <h2 class="aside-headline">
                              <span>售药机控制台</span>
                          </h2>
                          <ul class="aside-list">
                              <li>
                                  <a href="index.html" class="aside-list-level1">
                                      <span>概览</span>
                                  </a>
                              </li>
                              <li>
                                  <a href="#" class="aside-list-level1" id="readData">
                                      <span>读数据</span>
                                  </a>
                              </li>
                              <li>
                                  <a href="#" class="aside-list-level1">
                                      <span>控制</span>
                                  </a>
                              </li>
                              <li>
                                  <a href="#" class="aside-list-level1">
                                      <span>其他</span>
                                  </a>
                              </li>

                          </ul>
                      </div>
                      <div class="menu-fold" id="aside-button">
                          <div class="sidebar-lineWrap">
                              <span class="sidebar-toggle-line"></span>
                              <span class="sidebar-toggle-line"></span>
                              <span class="sidebar-toggle-line"></span>
                          </div>
                      </div>
                  </div>
                  <div class="menu-close-btn">
                      <div class="sidebar-lineWrap">
                          <span class="sidebar-toggle-line"></span>
                          <span class="sidebar-toggle-line"></span>
                          <span class="sidebar-toggle-line"></span>
                      </div>
                  </div>

                  <div class="main" id="appArea">
                      <div class="manage-area console">
                          <div class="manage-area-title">
                              <h2>移动药房概览</h2>
                          </div>
                          <div class="manage-area-main">
                              <div>
                                  <div class="yy-manage">
                                      <div class="yy-display-1">
                                          <div class="mod-console">
                                              <div class="mod-console-hd">
                                                  <h3>温湿度状态</h3>
                                              </div>
                                              <div class="mod-console-bd">
                                                  <div class="dashboard">
                                                      <div class="dashboard-chart-t">
                                                          <div class="tem-pic">
                                                              <img src="./src/img/wendu.jpg" alt="温度计图标">
                                                          </div>
                                                          <div id="display-tem"></div>
                                                      </div>
                                                      <div class="dashboard-chart-h" >
                                                          <div class="hum-pic">
                                                              <img src="./src/img/shidu.jpg" alt="湿度计图标">
                                                          </div>
                                                          <div id="display-hum"></div>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                      <div class="yy-display-1">
                                          <div class="mod-console">
                                              <div class="mod-console-hd">
                                                  <h3>温湿度历史状况</h3>
                                              </div>
                                              <div class="mod-console-bd">
                                                  <div class="dashboard">
                                                      <div class="dashboard-chart-th">
                                                         <canvas id="th-chart" width="500" height="200"></canvas>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                                  <div class="yy-manage">
                                      <div class="yy-display-2">
                                          <div class="mod-console">
                                              <div class="mod-console-hd">
                                                  <h3>药品库存实时监控情况</h3>
                                              </div>
                                              <div class="mod-console-bd">
                                                  <div class="dashboard">
                                                      <div class="dashboard-chart-stock">
                                                          <canvas id="stock-chart" width="900" height="400"></canvas>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>

                <div id="showLogs">
                  <span id="log"></span>
                  <button id="clear" onclick="clearLog();">clear</button><br/>
                </div>
              </div>
        </div> -->

        <div class="pageWrapper">
            <div class="head">
                <div class="head-nav">
                    <div>
                        <!-- 待添加头部导航栏 -->
                    </div>
                </div>
                <div class="head-msg">
                        <h2>欢迎线上选购</h2>
                </div>
            </div>
            <div class="body-main">
                <div class="showdrugs">
                    <div class="flex-box" id="box1">
                        <div class="column">
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src//img/头孢.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>头孢</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add1">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="./src/img/jia.png" alt="加"> -->
                                     </div>
                                     <div class="numshow">
                                        <input id="nums1" type="text" name="" value="0" style="width: 100%;">                         
                                     </div>
                                     <div class="decbtn" id="dec1">
                                          <span class="toggle-line1"></span>
                                         <!-- <img src="./src/img/jian.png" alt="减"> -->
                                     </div>
                                </div>
                            </div>
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src//img//咳特灵.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>咳特灵</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add2">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                     <div class="numshow">
                                        <input id="nums2" type="text" name="" value="0" style="width: 100%;">                          
                                     </div>
                                     <div class="decbtn" id="dec2">
                                         <span class="toggle-line1"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                </div>
                            </div>
                        </div>
                        <div class="column">
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src/img//心可舒丸.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>心可舒丸</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add3">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                     <div class="numshow">
                                          <input id="nums3" type="text" name="" value="0" style="width: 100%;">                      
                                     </div>
                                     <div class="decbtn" id="dec3">
                                         <span class="toggle-line1"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                </div>
                            </div>
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src//img//止血宝.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>止血宝颗粒</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add4">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                     <div class="numshow">
                                         <input id="nums4" type="text" name="" value="0" style="width: 100%;">                    
                                     </div>
                                     <div class="decbtn" id="dec4">
                                         <span class="toggle-line1"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex-box2" id="box2">
                        <div class="column">
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src//img//小儿腹痛.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>小儿腹痛</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add5">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="./src/img/jia.png" alt="加"> -->
                                     </div>
                                     <div class="numshow">
                                        <input id="nums5" type="text" name="" value="0" style="width: 100%;">                         
                                     </div>
                                     <div class="decbtn" id="dec5">
                                          <span class="toggle-line1"></span>
                                         <!-- <img src="./src/img/jian.png" alt="减"> -->
                                     </div>
                                </div>
                            </div>
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src/img/头孢.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>风湿定胶囊</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add6">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                     <div class="numshow">
                                        <input id="nums6" type="text" name="" value="0" style="width: 100%;">                          
                                     </div>
                                     <div class="decbtn" id="dec6">
                                         <span class="toggle-line1"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                </div>
                            </div>
                        </div>
                        <div class="column">
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src//img//降糖胶囊.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>降糖胶囊</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add7">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                     <div class="numshow">
                                          <input id="nums7" type="text" name="" value="0" style="width: 100%;">                      
                                     </div>
                                     <div class="decbtn" id="dec7">
                                         <span class="toggle-line1"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                </div>
                            </div>
                            <div class="drugblock-1">
                                <div class="drug-pic">      <!-- 购买药品图片显示 -->
                                    <img src="./src//img//化痰平喘片.png" alt="药品图片">
                                </div>
                                <div class="drug-info">     <!-- 购买药品信息显示 -->
                                    <span>化痰平喘片</span>
                                </div>
                                <div class="drug-select">    <!-- 购买药品数量选择 -->
                                     <div class="addbtn" id="add8">
                                         <span class="toggle-line1"></span>
                                         <span class="toggle-line2"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                     <div class="numshow">
                                         <input id="nums8" type="text" name="" value="0" style="width: 100%;">                    
                                     </div>
                                     <div class="decbtn" id="dec8">
                                         <span class="toggle-line1"></span>
                                         <!-- <img src="" alt=""> -->
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="payover" id="box3">
                        <div class="tips overpage">
                            <span>药品购买成功,请凭验证码到售药终端取药！</span>
                        </div>
                        <div class="yzm overpage">
                            <span id="yzid" style="font-size: 7rem; color: deeppink"></span>
                        </div>
                        <div class="warmtips overpage">
                            <span>祝您早日康复，健康生活每一天 (๑•̀ㅂ•́)و✧</span>
                        </div>
                    </div>
                </div>
                <div class="bottomtab">
                    <div class="left" id="leftbtn">
                        <!-- <a href="#"></a>    -->
                        <img src="./src//img//left.png" alt="左切换" width="110px" height="110px">
                    </div>
                    <div class="right" id="rightbtn">
                        <img src="./src//img//right.png" alt="右切换" width=" 110px" height="110px">
                        <!-- <a href="#"></a> -->
                    </div>
                </div>
            </div>
            <div class="subbtn">
                <button type="button" id="adddrug" class="surebtn" style="width: 150px; height: 150px;">添加待买</button>
                <button type="button" id="suredrug" class="surebtn" style="width: 150px; height: 150px;">确认购买</button>
                <button type="button" id="canceldrug" class="surebtn" style="width: 150px; height: 150px;">取消待买</button>
            </div>
        </div>

        <!-- <div id="showLogs">
                  <span id="log"></span>
                  <button id="clear" onclick="clearLog();">clear</button><br/>
       </div> -->
   

        <script>
            var sendFontBuffer = new Array(10);   // 发送后端数组  信息包括 1.药品名  2.药品数量  3.随机数验证码 数据格式[A-2-y-xxxx] 
            var selectDrugs = (function () {
                
                var addbtn1 = $("#add1");
                var decbtn1 = $("#dec1");
                var drugnums1 = $("#nums1");
                var addbtn2 = $("#add2");
                var decbtn2 = $("#dec2");
                var drugnums2 = $("#nums2");
                var addbtn3 = $("#add3");
                var decbtn3 = $("#dec3");
                var drugnums3 = $("#nums3");
                var addbtn4 = $("#add4");
                var decbtn4 = $("#dec4");
                var drugnums4 = $("#nums4");
                var addbtn5 = $("#add5");
                var decbtn5 = $("#dec5");
                var drugnums5 = $("#nums5");
                var addbtn6 = $("#add6");
                var decbtn6 = $("#dec6");
                var drugnums6 = $("#nums6");
                var addbtn7 = $("#add7");
                var decbtn7 = $("#dec7");
                var drugnums7 = $("#nums7");
                var addbtn8 = $("#add8");
                var decbtn8 = $("#dec8");
                var drugnums8 = $("#nums8");

                var addDrugsbtn = $("#adddrug");     // 待选药品按钮
                var sureDrugbtn = $("#suredrug");    // 确定购药按钮
                var cancelDrugbtn = $("#canceldrug");    // 取消待选药按钮
                var yzmNum = $("#yzid");    // 验证码数字

                const nameBuffer = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                const fixZeroBuffer = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] 

                var readyBuyBuffer = new Array(10);  // 预支付存储数组
                var sureBuyBuffer = new Array();    // 确认购买数组


                function Init() {
                    addDrugsbtn.on('click', function() {

                        var NoZeroTimes = 0;
                        for (let i = 1; i <= 8; i++) {      // 依次读取选药数量值

                            eval("readyBuyBuffer[" + (i-1) + "]" + "=" + "drugnums" + i + '.' + 'val()');
                            if(readyBuyBuffer[i-1] != 0) NoZeroTimes++;
                            
                        }

                        if (NoZeroTimes < 2) {
                            
                            for (let i = 0; i < 8; i++) {

                                if (readyBuyBuffer[i] != 0) {
                                    
                                    // drugnums1.css('color', 'red');
                                    sureBuyBuffer[0] = nameBuffer[i];
                                    sureBuyBuffer[1] = readyBuyBuffer[i];
                                    console.log(sureBuyBuffer);
                                    eval("drugnums" + (i+1) + '.' + "css" + "(\"color\"," + "\"red\")");
                                    return;
                                }
                            }
                        } else {  
                            if (confirm("请选择至多一种药品!")) {

                                console.log("继续修改添加");
                            } else {
                                
                                console.log("保留原添加信息");
                            }
                        }
                    });

                    cancelDrugbtn.on("click", function () {     // 取消带选取药品
                        
                        for (let i = 0; i < 8; i++) {

                            eval("drugnums" + (i+1) + '.' + "css" + "(\"color\"," + "\"black\")");
                        }

                        for (let i = 0; i < 8; i++) {       // 清空选择药品

                            eval("drugnums" + (i+1) + '.' + 'val(0)');
                        }
                        sureBuyBuffer[0] = 0;   // 确定待支付数组
                        sureBuyBuffer[1] = 0;  
                        console.log('待支付数组' + sureBuyBuffer);
                    });

                    sureDrugbtn.on('click', function () {       // 确定支付所选药品
                        
                        if (confirm("确定购买吗？")) {
                            
                            compareNum = Math.floor((Math.random())*10000);   // 生成4位随机数验证码
                            console.log(compareNum);
                            if(compareNum <= 10) {      // 将一位变为4位
                                compareNum = compareNum*1000;
                            }
                            if(compareNum <= 100) {     // 将两位变为4位
                                compareNum = compareNum*100;
                            }
                            if(compareNum <= 1000) {    // 将三位变为4位
                                compareNum = compareNum*10;
                            }
                            console.log(compareNum);
                            console.log(compareNum.toString().indexOf('0'));
                            if (compareNum.toString().indexOf(0) != -1) {
                                
                                console.log('有0');
                                compareNum = compareNum.toString().replace(/0/g,'1');   // 将验证码中0替换为其他数
                            }
                            console.log("yzm:" + compareNum);
                            yzmNum.text(compareNum);     // 将验证码id添加显示
                            sendFontBuffer = [].concat(sureBuyBuffer);      // 将待发送数组的内容弄到发送数组里面
                            sendFontBuffer.push('y');
                            var yzmstring = compareNum.toString();
                            var yzmcharArr = yzmstring.split('');
                            for(let i = 0; i < 4; i++) {

                                sendFontBuffer.push(yzmcharArr[i]);
                            }
                            for (let i = 0; i < 13; i++) {

                                sendFontBuffer.push(0);
                            }
                            
                            for (let i = 0; i < 8; i++) {       // 清空选择药品

                                eval("drugnums" + (i+1) + '.' + 'val(0)');
                            }
                            for (let i = 0; i < 8; i++) {       // 标注为黑色

                                eval("drugnums" + (i+1) + '.' + "css" + "(\"color\"," + "\"black\")");
                            }

                            writeCommand();     // 向下位机发送信息
                            // console.log("发送的数组是:" + sendFontBuffer);
                            sendFontBuffer.splice(0,sendFontBuffer.length); // 清空数组  感觉可以不加

                            //  购买成功后页面的跳转
                            drugBox1.css('display', 'none');
                            drugBox2.css('display', 'none');
                            yzmBox.css('display', 'flex');

                            setTimeout(() => {      // 一定时间后自动返回
                                drugBox1.css('display', 'flex');
                                drugBox2.css('display', 'none');
                                yzmBox.css('display', 'none');
                            }, 1000*60);
                        }else {
                            // 取消购药的处理
                            sureBuyBuffer.splice(0,sureBuyBuffer.length);   // 清空预支付数组
                            for (let i = 0; i < 8; i++) {       // 清空选择药品

                                eval("drugnums" + (i+1) + '.' + 'val(0)');
                            }
                            for (let i = 0; i < 8; i++) {       // 标注为黑色

                                eval("drugnums" + (i+1) + '.' + "css" + "(\"color\"," + "\"black\")");
                            }
                        }
                    });

                    yzmNum.on("click", function () {    // 点击返回选药界面

                        drugBox1.css('display', 'flex');
                        drugBox2.css('display', 'none');
                        yzmBox.css('display', 'none');
                    });

                    addbtn1.on('click', function () {
                        drugnums1.val(parseInt(drugnums1.val()) + 1);
                        if(drugnums1.val() > 3) drugnums1.val(3);
                    });

                    decbtn1.on('click', function () {
                        drugnums1.val(parseInt(drugnums1.val()) - 1);
                        if(drugnums1.val() < 0) drugnums1.val(0);
                    });

                    addbtn2.on('click', function () {
                        drugnums2.val(parseInt(drugnums2.val()) + 1);
                        if(drugnums2.val() > 3) drugnums2.val(3);
                    });

                    decbtn2.on('click', function () {
                        drugnums2.val(parseInt(drugnums2.val()) - 1);
                        if(drugnums2.val() < 0) drugnums2.val(0);
                    });

                    addbtn3.on('click', function () {
                        drugnums3.val(parseInt(drugnums3.val()) + 1);
                        if(drugnums3.val() > 3) drugnums3.val(3);
                    });

                    decbtn3.on('click', function () {
                        drugnums3.val(parseInt(drugnums3.val()) - 1);
                        if(drugnums3.val() < 0) drugnums3.val(0);
                    });

                    addbtn4.on('click', function () {
                        drugnums4.val(parseInt(drugnums4.val()) + 1);
                        if(drugnums4.val() > 3) drugnums4.val(3);
                    });

                    decbtn4.on('click', function () {
                        drugnums4.val(parseInt(drugnums4.val()) - 1);
                        if(drugnums4.val() < 0) drugnums4.val(0);
                    });

                    addbtn5.on('click', function () {
                        drugnums5.val(parseInt(drugnums5.val()) + 1);
                        if(drugnums5.val() > 3) drugnums5.val(3);
                    });

                    decbtn5.on('click', function () {
                        drugnums5.val(parseInt(drugnums5.val()) - 1);
                        if(drugnums5.val() < 0) drugnums5.val(0);
                    });

                    addbtn6.on('click', function () {
                        drugnums6.val(parseInt(drugnums6.val()) + 1);
                        if(drugnums6.val() > 3) drugnums6.val(3);
                    });

                    decbtn6.on('click', function () {
                        drugnums6.val(parseInt(drugnums6.val()) - 1);
                        if(drugnums6.val() < 0) drugnums6.val(0);
                    });

                    addbtn7.on('click', function () {
                        drugnums7.val(parseInt(drugnums7.val()) + 1);
                        if(drugnums7.val() > 3) drugnums7.val(3);
                    });

                    decbtn7.on('click', function () {
                        drugnums7.val(parseInt(drugnums7.val()) - 1);
                        if(drugnums7.val() < 0) drugnums7.val(0);
                    });

                    addbtn8.on('click', function () {
                        drugnums8.val(parseInt(drugnums8.val()) + 1);
                        if(drugnums8.val() > 3) drugnums8.val(3);
                    });

                    decbtn8.on('click', function () {
                        drugnums8.val(parseInt(drugnums8.val()) - 1);
                        if(drugnums8.val() < 0) drugnums8.val(0);
                    });
                }
                Init();
            })();

        </script>
             
        <script>
            var leftArrow = $('#leftbtn');
            var rightArrow = $('#rightbtn');
            var drugBox1 = $('#box1');
            var drugBox2 = $('#box2');
            var yzmBox = $("#box3");

            drugBox2.css('display', 'none');

            yzmBox.css('display', 'none');    

            rightArrow.on('click', function () {

                drugBox1.css('display', 'none');
                drugBox2.css('display', 'flex');
            });

            leftArrow.on('click', function () {
                
                drugBox1.css('display', 'flex');
                drugBox2.css('display', 'none');
            });
            
            
        </script>
        <!-- <script>
              var asidClick = (function () {        // 侧边栏按键点击函数
                  function init() {

                      open = true;
                      let asideOpenIcon = $('#aside-button');
                      let asideMenu = $('.aside');
                      let mainPage = $('#appArea');
                      let asideCloseIcon = $('.menu-close-btn');
                      let asideMain = $('.side-area-main');

                      asideOpenIcon.on('click', function () {
                          if (open) {

                              asideMenu.css('width', '0');
                              mainPage.css('width', '96%');
                              asideMain.fadeOut('normal');
                              setTimeout(function () {
                                  asideCloseIcon.css('display', 'block');
                              }, 580);
                              open = false;
                          }
                      });

                      asideCloseIcon.on('click', function () {

                          if (!open) {

                              asideMenu.css('width', '200');
                              mainPage.css('width', '85%');
                              asideMain.fadeIn('normal');
                              asideCloseIcon.fadeOut(100);
                              open = true;
                          }
                      });
                  }
                  init();
              })();
        </script>
        <script>
            var readClick = (function () {          // 手动读取下位机信息
                function readInit() {

                    let readBlock = $('#readData');

                    readBlock.on('click', function () {

                        read();
                    })
                }
                readInit();
            })();
        </script> -->
</body>
</html>